# 想定シナリオ

## 顧客側シナリオ

### 1. 初回予約（Email/パスワード）

1. トップページにアクセス
2. 一覧からメニューを選択
3. カレンダーから希望日時を選択
4. スタッフを選択（任意・管理者設定により省略可）
5. ログイン画面で「Email/パスワードで登録」を選択
6. Email、パスワードを入力して会員登録
7. 会員情報を入力
   - 名前
   - カナ
   - Email
   - 電話番号
   - スポーツしているかチェック
     - 競技名
     - 所属
8. 確認画面で入力内容を確認
9. 予約を確定
10. 確認メールを受信
11. メールアドレス確認メールを受信し、リンクをクリックして確認完了
12. 予約日に来院
13. スタッフ用の端末で管理画面にアクセスし、初回問診を入力
    - 住所等のオプショナルな顧客情報
    - 問診

### 2. 初回予約（SSO）

1. トップページにアクセス
2. 一覧から希望メニューを選択
3. カレンダーから希望日時を選択
4. スタッフを選択（任意・管理者設定により省略可）
5. ログイン画面でプロバイダーを選択し、ログイン
6. 会員登録フォームに必要情報を入力
   - 名前
   - カナ
   - Email
   - 電話番号
   - スポーツしているかチェック
     - 競技名
     - 所属
7. 確認画面で入力内容を確認
8. 予約を確定
9. 確認メールを受信
10. メールアドレス確認メールを受信し、リンクをクリックして確認完了
11. 予約日に来院
12. スタッフ用の端末で管理画面にアクセスし、初回問診を入力
    - 住所等のオプショナルな顧客情報
    - 問診

### 3. 2回目以降の予約（既存会員）

1. トップページにアクセス
2. メニュー選択
3. 日時選択
4. スタッフ選択（任意・管理者設定により省略可）
5. ログイン（SSO/Email）
6. 確認画面（会員情報は登録済み）
7. 予約を確定
8. 確認メールを受信

### 4. 予約一覧の閲覧

1. マイページにログイン
2. 予約一覧画面へ遷移
3. 予約を一覧表示
   - 有効な予約
   - 過去の予約
   - キャンセル済みの予約
4. 予約詳細を確認

### 5. 予約の変更（日時変更）

1. マイページにログイン
2. 予約一覧から該当予約を選択
3. 変更ボタンをクリック
4. 新しい日時を選択
5. 確認画面で変更内容を確認
6. 変更を確定
7. 変更通知メールを受信

### 6. 予約のキャンセル

1. マイページにログイン
2. 予約一覧から該当予約を選択
3. キャンセルボタンをクリック
4. キャンセル確認
5. キャンセル完了
6. キャンセル通知メールを受信

### 7. 会員情報の変更（基本情報）

1. マイページにログイン
2. 会員情報編集画面へ遷移
3. 名前、電話番号などを変更
4. 確認画面
5. 変更を確定

### 8. メールアドレスの変更

1. マイページにログイン
2. 会員情報編集画面へ遷移
3. 新しいメールアドレスを入力
4. 確認画面
5. 変更を確定
6. 新しいメールアドレス宛に確認メールを受信
7. リンクをクリックして変更を完了

### 9. 予約リマインドメール受信

1. 予約日の前日（または設定された期間前）
2. リマインドメールを受信
3. 予約内容を確認

### 10. 満席時の予約

1. メニュー選択
2. 日時選択時、満席の枠は選択不可として表示
3. 空いている別の日時を選択

### 11. 予約受付時間外の予約

1. メニュー選択
2. 日時選択時、予約受付時間外の枠は選択不可として表示
3. 受付時間内の日時を選択

### 12. キャンセル受付時間を過ぎた予約のキャンセル

1. マイページにログイン
2. 予約一覧から該当予約を選択
3. キャンセル受付時間を過ぎているため、キャンセルボタンが無効化
4. 店舗に電話連絡を促すメッセージを表示

### 13. 変更受付時間を過ぎた予約の変更

1. マイページにログイン
2. 予約一覧から該当予約を選択
3. 変更受付時間を過ぎているため、変更ボタンが無効化
4. 店舗に電話連絡を促すメッセージを表示

## 店舗側シナリオ

### 1. スタッフアカウント発行

1. 適切な権限を持つ既存スタッフが管理者アカウントを発行
   - ロール選択（管理者／スタッフ etc...）
2. 発行されたEmailに初回ログイン用のリンクを送信
3. スタッフがリンクからパスワードを設定し、初回ログイン

### 2. 初期セットアップ

1. 管理画面にログイン
2. 店舗情報を登録
   - 店舗名
   - 住所
   - 電話番号
   - その他店舗情報
3. 営業時間を登録
   - 曜日ごとの営業時間（複数枠対応）
   - 定休日

### 3. 予約設定

1. 管理画面の予約管理へ
2. 予約の基本設定を登録
   - 予約枠の時間間隔（例：30分、60分）
   - 1枠あたりの最大予約数
   - 予約受付期限（例：3日前の23:59まで）
   - キャンセル受付期限（例：前日の23:59まで）
   - 変更受付期限（例：前日の23:59まで）
   - リマインドメール送信タイミング（例：前日の10:00）

### 4. メニュー登録・編集

1. 管理画面のメニュー管理へ
2. 新規メニュー登録ボタンまたは既存のメニューをクリック
3. メニュー情報を入力
   - 名前
   - 概要
   - 画像アップロード
   - 料金（自費の場合）
   - 自費／保険適用の区分
4. 保存

### 5. スタッフ登録・編集

1. 管理画面のスタッフ管理へ
2. 新規スタッフ登録ボタンまたは既存のスタッフをクリック
3. スタッフ情報を入力
   - スタッフ名
   - スタッフ画像
   - 担当可能なメニュー
   - スタッフタイプ
      - 常勤
      - 非常勤
   - 出勤時間（常勤の場合）
4. 保存

### 6. 臨時休業の設定

1. 管理画面の営業時間管理へ
2. カレンダーを表示
   - 既存予約がある日時は非活性（選択不可）
   - 既存予約がない日時のみ選択可能
3. 休業する日時を選択
4. 休業設定を保存

### 7. スタッフのシフト管理（スタッフ指名可能な場合）

1. 管理画面のスタッフ管理へ
2. カレンダーから日付を選択
3. スタッフの勤務時間を設定
   - 常勤は休む時間を設定
   - 非常勤は出勤する時間を指定
4. 保存

### 8. 予約状況の確認

1. 管理画面のカレンダー画面へ
2. 日付を選択
3. その日の予約一覧を表示
   - 時間枠ごとの予約状況
   - 顧客情報
   - メニュー情報
4. 予約詳細を確認

### 9. 顧客情報の確認・編集

1. 管理画面の顧客管理へ
2. 顧客一覧から該当顧客を検索
3. 顧客詳細を表示
   - 基本情報
   - 予約履歴
   - 来院履歴
4. 必要に応じて情報を編集

### 10. 直接予約（管理者側）

1. 管理画面のカレンダー画面へ
2. 日時を選択
3. 新規予約ボタンをクリック
4. 顧客を検索または新規作成
5. メニューを選択
6. スタッフを選択（任意）
7. 予約を確定
8. 顧客に確認メールを送信（任意）

### 11. 予約の編集（管理者側）

1. 予約一覧から該当予約を選択
2. 編集ボタンをクリック
3. 日時、メニュー、スタッフなどを変更
4. 変更を確定
5. 顧客に変更通知メールを送信

### 12. 予約のキャンセル（管理者側）

1. 予約一覧から該当予約を選択
2. キャンセル理由を入力
3. キャンセルを実行
4. 顧客にキャンセル通知メールを送信

### 13. 顧客の直接作成

1. 管理画面の顧客管理へ
2. 新規顧客作成ボタンをクリック
3. 顧客情報を入力
   - 名前
   - カナ
   - Email
   - 電話番号
   - その他の情報
4. 保存

### 14. 来院確認

1. 管理画面のカレンダー画面へ
2. 予約一覧から該当予約を選択
3. 来院確認ボタンをクリック
4. 来院時刻を記録

### 15. No-show（無断キャンセル）処理

1. 管理画面のカレンダー画面へ
2. 予約一覧から該当予約を選択
3. No-showボタンをクリック
4. No-show理由を入力（任意）
5. 顧客の予約履歴にNo-showを記録

### 16. 初診患者情報の入力（来院時）

1. 管理画面の顧客管理へ
2. 顧客一覧から該当顧客を検索
3. 初回問診ボタンをクリック
4. タブレットで顧客に情報を入力してもらう
   - 住所等オプショナルな個人情報
   - 一般的な問診
5. 入力された情報を確認・保存

## エラーケースシナリオ

### 1. 重複予約の防止

1. 顧客Aが日時を選択
2. 確認画面まで進む
3. 同時刻に顧客Bが同じ日時を選択し、先に予約確定
4. 顧客Aが予約確定しようとする
5. 満席エラーを表示
6. 別の日時を選択するよう促す

### 2. ログイン失敗

1. ログイン画面でEmail/パスワードを入力
2. 認証情報が間違っている
3. エラーメッセージを表示
4. 再入力を促す

### 3. 会員登録時のバリデーションエラー

1. 会員登録フォームで不正な情報を入力
   - Email形式が不正
   - 電話番号の桁数が不正
2. バリデーションエラーを表示
3. 正しい形式での入力を促す

### 4. ネットワークエラー

1. 予約確定時にネットワークエラーが発生
2. エラーメッセージを表示
3. 再試行ボタンを表示
4. 予約が完了したか不明な場合は、マイページで確認するよう促す

### 5. セッションタイムアウト

1. ログイン後、長時間操作しない
2. 予約確定時にセッションタイムアウトエラー
3. 再ログインを促す
4. 入力情報は可能な限り保持

### 6. 予約変更時の競合

1. 顧客が予約変更画面で新しい日時を選択
2. 確認画面まで進む
3. 同時刻に別の顧客が同じ日時を予約し、先に確定
4. 変更確定しようとする
5. 満席エラーを表示
6. 別の日時を選択するよう促す

### 7. メニュー削除時の既存予約への影響

1. 管理者がメニューを削除しようとする
2. そのメニューで既存予約がある場合は警告を表示
3. 既存予約がない場合のみ削除可能
4. 削除されたメニューは新規予約で選択不可

### 8. スタッフ削除時の既存予約への影響

1. 管理者がスタッフを削除しようとする
2. そのスタッフで既存予約がある場合は警告を表示
3. 既存予約がない場合のみ削除可能
4. 削除されたスタッフは新規予約で選択不可

## その他のシナリオ

### 1. 通知メールの不達・再送信

1. 予約確定後、確認メールが届かない
2. マイページにログイン
3. 予約詳細画面へ遷移
4. メール再送信ボタンをクリック
5. 確認メールを再送信

### 2. パスワードリセット

1. ログイン画面で「パスワードを忘れた」をクリック
2. 登録済みEmailアドレスを入力
3. パスワードリセット用のリンクをメールで受信
4. リンクから新しいパスワードを設定
5. 新しいパスワードでログイン

### 3. アカウント削除

1. マイページにログイン
2. アカウント設定画面へ
3. アカウント削除ボタンをクリック
4. 確認画面で警告を表示
   - 有効な予約がある場合は削除不可
   - 予約履歴は削除される旨を通知
5. 削除を確定
6. アカウントが削除され、ログアウト
7. 削除完了メールを受信
